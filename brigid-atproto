#! /usr/bin/env lua

-- Copyright (c) 2024 <dev@brigid.jp>
-- This software is released under the MIT License.
-- https://opensource.org/licenses/mit-license.php

local brigid = require "brigid"
local brigid_atproto = require "brigid.atproto"

brigid.dlopen_self()

local IDENTIFIER, PASSWORD = ...

local atproto <close> = brigid_atproto("https://bsky.social", "brigid-atproto/0.1")
atproto.debug = true
if not atproto:load_session(IDENTIFIER) then
  assert(atproto:create_session(IDENTIFIER, PASSWORD))
end

-- local handle = assert(io.open("tmp.json"))
-- local session = brigid.json.parse(handle:read "*a")

-- local session = atproto:create_session(IDENTIFIER, PASSWORD)
-- atproto.session = session
-- atproto:refresh_session()
atproto:delete_session()
